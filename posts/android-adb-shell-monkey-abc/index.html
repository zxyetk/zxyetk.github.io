<!doctype html><html lang=zh-hans><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=HandheldFriendly content="True"><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=generator content="Hugo 0.80.0"><link rel=apple-touch-icon sizes=180x180 href=/img/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/img/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/img/favicon-16x16.png><link rel=manifest href=/img/site.webmanifest><link rel=mask-icon href=/img/safari-pinned-tab.svg color=#8aa2d3><link rel="shortcut icon" href=/img/favicon.ico><meta name=theme-color content="#ffffff"><title>Android随机测试工具Monkey简介 - 仲夏叶 | 科技</title><meta name=author content="仲夏叶"><meta name=description content="生命就是用求知的欲望燃烧自己"><meta name=keywords content="android,monkey"><meta property="og:title" content="Android随机测试工具Monkey简介"><meta name=twitter:title content="Android随机测试工具Monkey简介"><meta property="og:type" content="article"><meta property="og:url" content="https://zxye.tk/posts/android-adb-shell-monkey-abc/"><meta property="og:description" content="Monkey 是一个在模拟器或设备上运行的程序，可生成伪随机用户事件（例如点击、轻触或手势）流以及很多系统级事件。您可以使用 Monkey 以随机且可重复的方式对正在开发的应用进行压力测试。"><meta name=twitter:description content="Monkey 是一个在模拟器或设备上运行的程序，可生成伪随机用户事件（例如点击、轻触或手势）流以及很多系统级事件。您可以使用 Monkey 以随机且可重复的方式对正在开发的应用进行压力测试。"><meta property="og:image" content="https://zxye.tk/img/avatar.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://zxye.tk/img/avatar.png"><meta property="article:published_time" content="2019-12-23T16:11:14+00:00"><meta property="article:modified_time" content="2019-12-23T16:11:14+00:00"><style>@media(prefers-color-scheme:dark){body[data-theme=auto] img{filter:brightness(60%)}}body[data-theme=dark] img{filter:brightness(60%)}</style><link rel=stylesheet href=https://zxye.tk/assets/css/fuji.min.css></head><body data-theme=auto><script data-cfasync=false>var fujiThemeData=localStorage.getItem('fuji_data-theme');if(!fujiThemeData){localStorage.setItem('fuji_data-theme','auto');}else{if(fujiThemeData!=='auto'){document.body.setAttribute('data-theme',fujiThemeData==='dark'?'dark':'light');}}</script><header><div class="container-lg clearfix"><div class="col-12 header"><a class=title-main href=https://zxye.tk>仲夏叶 | 科技</a>
<span class=title-sub>生命就是用求知的欲望燃烧自己</span></div></div></header><main><div class="container-lg clearfix"><div class="col-12 col-md-9 float-left content"><article><h2 class="post-item post-title"><a href=https://zxye.tk/posts/android-adb-shell-monkey-abc/>Android随机测试工具Monkey简介</a></h2><div class="post-item post-meta"><span><i class="iconfont icon-today-sharp"></i>&nbsp;2019-12-23</span><span><i class="iconfont icon-file-tray-sharp"></i>&nbsp;2238 字</span><span><i class="iconfont icon-time-sharp"></i>&nbsp;5 分钟</span><span><i class="iconfont icon-pricetags-sharp"></i>&nbsp;<a href=/tags/android>android</a>&nbsp;<a href=/tags/monkey>monkey</a>&nbsp;</span></div><div class="post-content markdown-body"><p>Monkey 是一个在<a href=https://developer.android.com/tools/help/emulator.html target=_blank>模拟器</a>或设备上运行的程序，可生成伪随机用户事件（例如点击、轻触或手势）流以及很多系统级事件。您可以使用 Monkey 以随机且可重复的方式对正在开发的应用进行压力测试。</p><h1 id=概览>概览</h1><p>Monkey 是一个命令行工具，可以在任何模拟器实例或设备上运行。它会将伪随机用户事件流发送到系统中，从而在您正在开发的应用软件上进行压力测试。</p><p>Monkey 包含许多选项，主要分为以下四个类别：</p><ul><li>基本配置选项，例如设置要尝试的事件数。</li><li>操作限制条件，例如将测试对象限制为单个软件包。</li><li>事件类型和频率。</li><li>调试选项。</li></ul><p>Monkey 在运行时会生成事件并将其发送到系统。它还会监视被测系统并查找三种特殊情况：</p><ul><li>如果您已将 Monkey 限制为在一个或多个特定软件包中运行，它会监视转到任何其他软件包的尝试并阻止它们。</li><li>如果应用崩溃或收到任何未处理的异常，Monkey 会停止并报告错误。</li><li>如果应用生成“应用无响应”错误，Monkey 会停止并报告错误。</li></ul><p>根据您选择的详细程度级别，您还将看到有关 Monkey 进度和所生成事件的报告。</p><h2 id=monkey-的基本用法>Monkey 的基本用法</h2><p>您可以使用开发计算机上的命令行启动 Monkey，也可以通过脚本启动。由于 Monkey 在模拟器/设备环境中运行，因此您必须从该环境中通过 shell 启动它。为此，您可以在每个命令前面加上 <code>adb shell</code>，或者直接进入 shell 并输入 Monkey 命令。</p><p>基本语法如下：</p><pre><code>$ adb shell monkey [options] &lt;event-count&gt;
</code></pre><p>如果未指定任何选项，Monkey 将以静默（非详细）模式启动，并将事件发送到目标上安装的任何（及所有）软件包。下面是一个更典型的命令行，它会启动您的应用并向其发送 500 个伪随机事件：</p><pre><code>$ adb shell monkey -p your.package.name -v 500
</code></pre><h2 id=命令选项参考>命令选项参考</h2><p>下表列出了您可以在 Monkey 命令行中添加的所有选项。</p><table><thead><tr><th style=text-align:left>类别</th><th style=text-align:left>选项</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>常规</td><td style=text-align:left><code>--help</code></td><td style=text-align:left>输出简单的使用指南。</td></tr><tr><td style=text-align:left><code>-v</code></td><td style=text-align:left>命令行上的每个 -v 都会增加详细程度级别。级别 0（默认值）只提供启动通知、测试完成和最终结果。级别 1 提供有关测试在运行时（例如发送到您的 Activity 的各个事件）的更多详细信息。级别 2 提供更详细的设置信息，例如已选择或未选择用于测试的 Activity。</td><td style=text-align:left></td></tr><tr><td style=text-align:left>事件</td><td style=text-align:left><code>-s</code></td><td style=text-align:left>伪随机数生成器的种子值。如果您使用相同的种子值重新运行 Monkey，它将会生成相同的事件序列。</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>--throttle</code></td><td style=text-align:left>在事件之间插入固定的延迟时间。您可以使用此选项减慢 Monkey 速度。如果未指定，则没有延迟，系统会尽快地生成事件。</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>--pct-touch</code></td><td style=text-align:left>调整轻触事件所占百分比。（轻触事件是指屏幕上的单个位置上的按下/释放事件。）</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>--pct-motion</code></td><td style=text-align:left>调整动作事件所占百分比。（动作事件包括屏幕上某个位置的按下事件，一系列伪随机动作和一个释放事件。）</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>--pct-trackball</code></td><td style=text-align:left>调整轨迹球事件所占百分比。（轨迹球事件包括一个或多个随机动作，有时后跟点击。）</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>--pct-nav</code></td><td style=text-align:left>调整“基本”导航事件所占百分比。（导航事件包括向上/向下/向左/向右，作为方向输入设备的输入。）</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>--pct-majornav</code></td><td style=text-align:left>调整“主要”导航事件所占百分比。（这些导航事件通常会导致界面中的操作，例如 5 方向键的中间按钮、返回键或菜单键。）</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>--pct-syskeys</code></td><td style=text-align:left>调整“系统”按键事件所占百分比。（这些按键通常预留供系统使用，例如“主屏幕”、“返回”、“发起通话”、“结束通话”或“音量控件”。）</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>--pct-appswitch</code></td><td style=text-align:left>调整 Activity 启动次数所占百分比。Monkey 会以随机间隔发起 startActivity() 调用，以最大限度地覆盖软件包中的所有 Activity。</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>--pct-anyevent</code></td><td style=text-align:left>调整其他类型事件所占百分比。这包括所有其他类型的事件，例如按键、设备上的其他不太常用的按钮等等。</td></tr><tr><td style=text-align:left>约束</td><td style=text-align:left><code>-p</code></td><td style=text-align:left>如果您通过这种方式指定一个或多个软件包，Monkey 将仅允许系统访问这些软件包内的 Activity。如果应用需要访问其他软件包中的 Activity（例如选择联系人），您还需要指定这些软件包。如果您未指定任何软件包，Monkey 将允许系统启动所有软件包中的 Activity。要指定多个软件包，请多次使用 -p 选项 - 每个软件包对应一个 -p 选项。</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>-c</code></td><td style=text-align:left>如果您通过这种方式指定一个或多个类别，Monkey 将仅允许系统访问其中一个指定类别中所列的 Activity。如果您没有指定任何类别，Monkey 会选择 Intent.CATEGORY_LAUNCHER 或 Intent.CATEGORY_MONKEY 类别所列的 Activity。要指定多个类别，请多次使用 -c 选项 - 每个类别对应一个 -c 选项。</td></tr><tr><td style=text-align:left>调试</td><td style=text-align:left><code>--dbg-no-events</code></td><td style=text-align:left>指定后，Monkey 将初始启动到测试 Activity，但不会生成任何其他事件。为了获得最佳结果，请结合使用 -v、一个或多个软件包约束条件以及非零限制，以使 Monkey 运行 30 秒或更长时间。这提供了一个环境，您可以在其中监控应用调用的软件包转换操作。</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>--hprof</code></td><td style=text-align:left>如果设置此选项，此选项将在 Monkey 事件序列之前和之后立即生成分析报告。这将在 data/misc 下生成大型（约为 5Mb）文件，因此请谨慎使用。要了解如何分析性能分析报告，请参阅<a href=https://developer.android.com/studio/profile target=_blank>分析应用性能</a>。</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>--ignore-crashes</code></td><td style=text-align:left>通常，当应用崩溃或遇到任何类型的未处理异常时，Monkey 将会停止。如果您指定此选项，Monkey 会继续向系统发送事件，直到计数完成为止。</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>--ignore-timeouts</code></td><td style=text-align:left>通常情况下，如果应用遇到任何类型的超时错误（例如“应用无响应”对话框），Monkey 将会停止。如果您指定此选项，Monkey 会继续向系统发送事件，直到计数完成为止。</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>--ignore-security-exceptions</code></td><td style=text-align:left>通常情况下，如果应用遇到任何类型的权限错误（例如，如果它尝试启动需要特定权限的 Activity），Monkey 将会停止。如果您指定此选项，Monkey 会继续向系统发送事件，直到计数完成为止。</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>--kill-process-after-error</code></td><td style=text-align:left>通常情况下，当 Monkey 因出错而停止运行时，出现故障的应用将保持运行状态。设置此选项后，它将会指示系统停止发生错误的进程。注意，在正常（成功）完成情况下，已启动的进程不会停止，并且设备仅会处于最终事件之后的最后状态。</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>--monitor-native-crashes</code></td><td style=text-align:left>监视并报告 Android 系统原生代码中发生的崩溃。如果设置了 &ndash;kill-process-after-error，系统将会停止。</td></tr><tr><td style=text-align:left></td><td style=text-align:left><code>--wait-dbg</code></td><td style=text-align:left>阻止 Monkey 执行，直到为其连接了调试程序。</td></tr></tbody></table><p><strong>来源</strong></p><blockquote><p><a href=https://developer.android.com/studio/test/monkey target=_blank>UI/Application Exerciser Monkey</a></p></blockquote></div></article><div class="license markdown-body"><blockquote><p>除特殊注明部分，本站内容采用 <a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a> 进行许可。</p></blockquote></div></div><aside class="col-12 col-md-3 float-left sidebar"><div class="sidebar-item sidebar-pages"><h3>页面</h3><ul><li><a href=/>Home</a></li><li><a href=/index.xml>RSS</a></li></ul></div><div class="sidebar-item sidebar-links"><h3>链接</h3><ul><li><a href=https://github.com/stornado target=_blank><span>GitHub</span></a></li><li><a href=https://twitter.com/ryanstornado target=_blank><span>Twitter</span></a></li></ul></div><div class="sidebar-item sidebar-tags"><h3>标签</h3><div><span><a href=/tags/android/>android</a></span>
<span><a href=/tags/autotest/>autotest</a></span>
<span><a href=/tags/book/>book</a></span>
<span><a href=/tags/centos/>centos</a></span>
<span><a href=/tags/k8s/>k8s</a></span>
<span><a href=/tags/kubernetes/>kubernetes</a></span>
<span><a href=/tags/monkey/>monkey</a></span>
<span><a href=/tags/specification/>specification</a></span>
<span><a href=/tags/testing/>testing</a></span></div></div><div class="sidebar-item sidebar-toc"><h3>目录</h3><nav id=TableOfContents><ul><li><a href=#monkey-的基本用法>Monkey 的基本用法</a></li><li><a href=#命令选项参考>命令选项参考</a></li></ul></nav></div></aside></div><div class=btn><div class=btn-menu id=btn-menu><i class="iconfont icon-grid-sharp"></i></div><div class=btn-toggle-mode><i class="iconfont icon-contrast-sharp"></i></div><div class=btn-scroll-top><i class="iconfont icon-chevron-up-circle-sharp"></i></div></div><aside class=sidebar-mobile style=display:none><div class=sidebar-wrapper><div class="sidebar-item sidebar-pages"><h3>页面</h3><ul><li><a href=/>Home</a></li><li><a href=/index.xml>RSS</a></li></ul></div><div class="sidebar-item sidebar-links"><h3>链接</h3><ul><li><a href=https://github.com/stornado target=_blank><span>GitHub</span></a></li><li><a href=https://twitter.com/ryanstornado target=_blank><span>Twitter</span></a></li></ul></div><div class="sidebar-item sidebar-tags"><h3>标签</h3><div><span><a href=/tags/android/>android</a></span>
<span><a href=/tags/autotest/>autotest</a></span>
<span><a href=/tags/book/>book</a></span>
<span><a href=/tags/centos/>centos</a></span>
<span><a href=/tags/k8s/>k8s</a></span>
<span><a href=/tags/kubernetes/>kubernetes</a></span>
<span><a href=/tags/monkey/>monkey</a></span>
<span><a href=/tags/specification/>specification</a></span>
<span><a href=/tags/testing/>testing</a></span></div></div><div class="sidebar-item sidebar-toc"><h3>目录</h3><nav id=TableOfContents><ul><li><a href=#monkey-的基本用法>Monkey 的基本用法</a></li><li><a href=#命令选项参考>命令选项参考</a></li></ul></nav></div></div></aside></main><footer><div class="container-lg clearfix"><div class="col-12 footer"><p>除特殊注明部分，本站内容采用 <a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a> 进行许可。</p><span>&copy; 2021-2021
<a href=https://zxye.tk>仲夏叶</a>
| <a href=https://github.com/zxyetk/zxyetk.github.io>Source code</a>
| 基于 <a href=https://github.com/amzrk2/hugo-theme-fuji/ target=_blank>Fuji-v2</a> & <a href=https://gohugo.io/ target=_blank>Hugo</a> 构建</span></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.0/lazysizes.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-core.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js></script><script defer src=/assets/js/fuji.min.js></script></body></html>